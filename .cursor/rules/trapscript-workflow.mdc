---
description: TrapScript development workflow
alwaysApply: true
---

# TrapScript Workflow

TrapScript is a Python library designed to streamline scripting in FL Studio's VFX Script environment. It provides abstractions for MIDI voice handling, UI control creation, parameter management, output controllers, and export proxies. The library aims to reduce boilerplate code while offering intuitive, TouchDesigner-inspired APIs for creative coding in audio/MIDI effects.

See README.md for trapscript.py documentation

`scope.py` is the working environment for TrapScript development. FL Studio's built-in VFX Script editor is limited, so code is written/edited in `scope.py` and copy-pasted into FL Studio's VFX Script.

# VFX Script Documentation

VFX Script is a Patcher plugin in FL Studio that allows real-time transformation of MIDI notes and automation parameters using Python. See "VFX Script (Default)/" directory for native VFX Script code examples.

## Official Documentation

- [VFX Script Manual](https://www.image-line.com/fl-studio-learning/fl-studio-beta-online-manual/html/plugins/VFX%20Script.htm) - Full reference including API, examples, and tutorials
- [Piano Roll Scripting API](https://www.image-line.com/fl-studio-learning/fl-studio-online-manual/html/pianoroll_scripting_api.htm) - ScriptDialog class documentation for UI controls
- [VFX Scripting Forum](https://forum.image-line.com/viewforum.php?f=2053) - Community scripts and support

## Python API Resources

- [FL Studio Python API Stubs](https://il-group.github.io/FL-Studio-API-Stubs/) - Type hints and documentation for IDE support
- [GitHub: FL-Studio-API-Stubs](https://github.com/MaddyGuthridge/FL-Studio-API-Stubs) - Source repository

## API Reference

| Object | Member | Description |
|--------|--------|-------------|
| `vfx` | `addOutputController(name, default)` | Defines an output controller (automation) pin |
| `vfx` | `setOutputController(name, value)` | Sets the value of a defined output controller |
| `vfx.context` | `voices` | List of active Voice objects triggered by this script |
| `vfx.context` | `ticks` | Current host clock time in PPQ ticks (read-only) |
| `vfx.context` | `PPQ` | Project's Pulses Per Quarter note (read-only) |
| `vfx.context` | `isPlaying` | True if FL Studio transport is playing (read-only) |

### vfx.Voice

| Member | Type | Description |
|--------|------|-------------|
| `Voice()` | constructor | Creates a new, empty voice |
| `Voice(existingVoice)` | constructor | Creates new voice, copies properties from existingVoice |
| `note` | float | MIDI note number (e.g., 60.0 = C4). Fractional for microtuning |
| `finePitch` | float | Fine pitch offset in fractional note numbers |
| `velocity` | float | Note velocity (0.0 to 1.0) |
| `pan` | float | Stereo panning (-1.0 Left, 0.0 Center, 1.0 Right) |
| `length` | int | Duration in ticks. If set, auto-releases after this time |
| `color` | int | Note color / MIDI channel (0-15, corresponding to colors 1-16) |
| `output` | int | Voice output port for Patcher routing (0-based). Default 0 |
| `fcut` | float | Mod X parameter / filter cutoff (-1.0 to 1.0) |
| `fres` | float | Mod Y parameter / filter resonance (-1.0 to 1.0) |
| `trigger()` | method | Sends Note On for this voice |
| `release()` | method | Sends Note Off for this voice |
| `copyFrom(otherVoice)` | method | Copies all properties from otherVoice. Used for slide note handling |

### vfx.ScriptDialog

| Member | Description |
|--------|-------------|
| `ScriptDialog(title, description)` | Constructor: Creates the UI dialog |
| `addInputKnob(name, def, min, max, hint)` | Adds a float knob |
| `addInputKnobInt(name, def, min, max, hint)` | Adds an integer knob |
| `addInputCheckbox(name, def, hint)` | Adds a checkbox |
| `addInputCombo(name, opts, def_idx, hint)` | Adds a dropdown menu. `opts` is a list of strings |
| `addInputText(name, def_text, hint)` | Adds a text input field |
| `addInputSurface()` | Uses the embedded Control Surface as a UI |
| `addGroup(name)` | Starts a named UI group |
| `endGroup()` | Ends the current UI group |

### vfx.context.form

| Member | Description |
|--------|-------------|
| `getInputValue(name)` | Gets value from UI control. Use `'GroupName: ControlName'` for grouped controls |
| `setNormalizedValue(name, value)` | Sets value (normalized 0-1) of a UI control |

## Event Handlers

| Function | Description |
|----------|-------------|
| `createDialog()` | Define script UI, must return `vfx.ScriptDialog` |
| `onTick()` | Called every tick for continuous processing and updates |
| `onTriggerVoice(incomingVoice)` | Called when an incoming voice (note) is triggered. `incomingVoice` is a `vfx.Voice` |
| `onReleaseVoice(incomingVoice)` | Called when an incoming voice is released. `incomingVoice` is the original `vfx.Voice` that triggered |
